{
  "project": "Gemini 3 Pro Image Preview - Nuxt 4 迁移项目",
  "branchName": "ralph/nuxt4-migration",
  "description": "将现有的原生 JavaScript 应用迁移到 Nuxt 4 + Vue 3 + Nuxt UI 4 + Tailwind CSS 框架。目标是将单文件 app.js（约 3000+ 行）转换为模块化、类型安全、可维护的代码库，提升开发体验。",
  "userStories": [
    {
      "id": "US-001",
      "title": "项目脚手架与配置",
      "description": "作为开发者，我希望初始化 Nuxt 4 项目结构并完成正确配置，为迁移奠定坚实基础。",
      "acceptanceCriteria": [
        "使用 nuxi 初始化 Nuxt 4 项目",
        "安装依赖：@nuxt/ui, pinia, @pinia/nuxt, pinia-plugin-persistedstate, jszip",
        "配置 nuxt.config.ts，包含模块和 colorMode",
        "创建 tailwind.config.ts 并配置自定义主题",
        "正确配置 TypeScript",
        "目录结构符合迁移指南（app/, stores/, types/）",
        "开发服务器启动无错误"
      ],
      "priority": 1,
      "passes": false
    },
    {
      "id": "US-002",
      "title": "类型定义",
      "description": "作为开发者，我希望有完整的 TypeScript 类型定义，使代码库类型安全且自文档化。",
      "acceptanceCriteria": [
        "创建 types/image.d.ts，包含 ImageGenerationOptions, GeneratedImage, GenerationResult",
        "创建 types/chat.d.ts，包含 Session, Message, ChatState",
        "创建 types/provider.d.ts，包含 Provider, ProviderFormData",
        "创建 types/xhs.d.ts，包含 XHSHistory, StoryboardItem",
        "所有类型正确导出",
        "类型检查通过"
      ],
      "priority": 2,
      "passes": false
    },
    {
      "id": "US-003",
      "title": "工具函数迁移",
      "description": "作为开发者，我希望将工具函数迁移到 app/utils/，使其能被 Nuxt 自动导入并在应用中复用。",
      "acceptanceCriteria": [
        "实现 app/utils/escapeHtml.ts，包含 escapeHtml 和 unescapeHtml",
        "实现 app/utils/blobManager.ts，包含 BlobManager 类",
        "实现 app/utils/downloadImage.ts，包含下载函数",
        "实现 app/utils/base64Utils.ts，包含转换工具",
        "所有工具函数被 Nuxt 自动导入",
        "类型检查通过"
      ],
      "priority": 3,
      "passes": false
    },
    {
      "id": "US-004",
      "title": "IndexedDB Composable",
      "description": "作为开发者，我希望有一个可复用的 IndexedDB composable，正确封装数据持久化逻辑。",
      "acceptanceCriteria": [
        "实现 app/composables/useIndexedDB.ts",
        "支持 initDB, getAll, get, add, put, remove, clear 操作",
        "优雅处理 SSR（仅客户端）",
        "为不同存储类型提供泛型支持",
        "类型检查通过"
      ],
      "priority": 4,
      "passes": false
    },
    {
      "id": "US-005",
      "title": "Provider Store 与 Composable",
      "description": "作为用户，我希望管理多个 API 渠道，以便配置 Gemini 和 OpenAI 兼容端点。",
      "acceptanceCriteria": [
        "使用 Pinia 实现 stores/provider.ts",
        "实现 app/composables/useProvider.ts",
        "支持添加、更新、删除、切换渠道",
        "支持随机渠道选择（负载均衡）",
        "支持渠道测试功能",
        "持久化到 localStorage",
        "类型检查通过"
      ],
      "priority": 5,
      "passes": false
    },
    {
      "id": "US-006",
      "title": "Chat Store 与 Composable",
      "description": "作为用户，我希望管理聊天会话和消息，以便保留对话历史。",
      "acceptanceCriteria": [
        "使用 Pinia 实现 stores/chat.ts",
        "实现 app/composables/useChat.ts",
        "支持会话 CRUD 操作",
        "支持消息 CRUD 操作",
        "支持上下文数量管理",
        "持久化到 IndexedDB（GeminiProDB）",
        "类型检查通过"
      ],
      "priority": 6,
      "passes": false
    },
    {
      "id": "US-007",
      "title": "图像生成 Composable",
      "description": "作为用户，我希望使用 AI 生成图像，从文本提示创建视觉内容。",
      "acceptanceCriteria": [
        "实现 app/composables/useImageGeneration.ts",
        "支持 1K/2K/4K 分辨率",
        "支持多种长宽比",
        "支持参考图",
        "基于分辨率的进度模拟",
        "解析 Gemini 和 OpenAI 两种响应格式",
        "与 chat 和 file system composables 集成",
        "类型检查通过"
      ],
      "priority": 7,
      "passes": false
    },
    {
      "id": "US-008",
      "title": "文件系统 Composable",
      "description": "作为用户，我希望自动保存生成的图像到本地文件夹，以免丢失作品。",
      "acceptanceCriteria": [
        "实现 app/composables/useFileSystem.ts",
        "集成目录选择器",
        "支持自动保存功能",
        "支持权限管理",
        "对不支持的浏览器优雅降级",
        "类型检查通过"
      ],
      "priority": 8,
      "passes": false
    },
    {
      "id": "US-009",
      "title": "主题与 Toast Composables",
      "description": "作为用户，我希望有主题切换和 Toast 通知，获得良好的用户体验。",
      "acceptanceCriteria": [
        "实现 app/composables/useTheme.ts，集成 colorMode",
        "实现 app/composables/useToast.ts，包含 success/error/warning/info 方法",
        "使用 Nuxt UI v4 语义化颜色（success, error, warning, info）",
        "主题设置持久化",
        "类型检查通过"
      ],
      "priority": 9,
      "passes": false
    },
    {
      "id": "US-010",
      "title": "UI 组件 - 核心",
      "description": "作为用户，我希望有核心 UI 组件，获得一致的视觉反馈。",
      "acceptanceCriteria": [
        "实现 app/components/ui/Loading.vue",
        "实现 app/components/ui/SmartProgressBar.vue",
        "实现 app/components/ui/Lightbox.vue",
        "使用 Nuxt UI v4 组件",
        "响应式设计",
        "类型检查通过"
      ],
      "priority": 10,
      "passes": false
    },
    {
      "id": "US-011",
      "title": "图像生成器组件",
      "description": "作为用户，我希望有图像生成器界面，输入提示词并配置生成设置。",
      "acceptanceCriteria": [
        "实现 app/components/image/ImageGenerator.vue",
        "使用 UTextarea 的提示词输入",
        "分辨率和长宽比选择器",
        "参考图上传",
        "生成/取消按钮",
        "集成进度条",
        "类型检查通过"
      ],
      "priority": 11,
      "passes": false
    },
    {
      "id": "US-012",
      "title": "聊天组件",
      "description": "作为用户，我希望有聊天界面组件，查看对话历史。",
      "acceptanceCriteria": [
        "实现 app/components/chat/MessageList.vue",
        "实现 app/components/chat/MessageItem.vue",
        "实现 app/components/chat/InputArea.vue",
        "消息中的图片预览",
        "消息操作（复制、编辑、删除、重新生成）",
        "类型检查通过"
      ],
      "priority": 12,
      "passes": false
    },
    {
      "id": "US-013",
      "title": "设置组件",
      "description": "作为用户，我希望有设置组件，配置应用程序。",
      "acceptanceCriteria": [
        "实现 app/components/settings/ProviderManager.vue",
        "实现 app/components/settings/ThemeSwitch.vue",
        "实现 app/components/settings/SettingsPanel.vue",
        "使用 Nuxt UI v4 的 UFormField, USwitch, UModal",
        "类型检查通过"
      ],
      "priority": 13,
      "passes": false
    },
    {
      "id": "US-014",
      "title": "BananaTool 与自定义提示词",
      "description": "作为用户，我希望有提示词库工具，快速查找和使用有效的提示词。",
      "acceptanceCriteria": [
        "实现 app/composables/useBananaTool.ts，支持多源加载",
        "实现 stores/prompts.ts 用于自定义提示词",
        "实现 app/components/tools/BananaTool.vue",
        "支持搜索、复制、应用、保存功能",
        "类型检查通过"
      ],
      "priority": 14,
      "passes": false
    },
    {
      "id": "US-015",
      "title": "切片工具",
      "description": "作为用户，我希望有图片切片工具，从图片创建网格布局。",
      "acceptanceCriteria": [
        "实现 app/composables/useSlicer.ts",
        "实现 app/components/tools/SlicerTool.vue",
        "可配置行/列/间隙",
        "九宫格预设",
        "2x 高清输出选项",
        "JSZip 批量下载",
        "类型检查通过"
      ],
      "priority": 15,
      "passes": false
    },
    {
      "id": "US-016",
      "title": "表情包制作模式",
      "description": "作为用户，我希望有表情包/贴纸创作模式，轻松制作 LINE 风格的表情包。",
      "acceptanceCriteria": [
        "实现 app/composables/useStickerMode.ts",
        "实现 app/components/tools/StickerMode.vue",
        "预设表情和动作",
        "背景选项（白色/透明）",
        "支持批量生成",
        "类型检查通过"
      ],
      "priority": 16,
      "passes": false
    },
    {
      "id": "US-017",
      "title": "XHS 灵感实验室模块",
      "description": "作为用户，我希望有小红书内容创作工具，使用 AI 生成社交媒体帖子。",
      "acceptanceCriteria": [
        "实现 stores/xhs.ts，持久化到 IndexedDB",
        "实现 app/composables/useXHS.ts",
        "实现 app/pages/xhs.vue，三栏布局",
        "主题输入和内容生成",
        "分镜规划",
        "批量图片生成",
        "历史记录管理",
        "类型检查通过"
      ],
      "priority": 17,
      "passes": false
    },
    {
      "id": "US-018",
      "title": "布局与页面",
      "description": "作为用户，我希望有合适的页面布局，使应用有一致的导航。",
      "acceptanceCriteria": [
        "实现 app/layouts/default.vue",
        "实现 app/pages/index.vue（主聊天/生成页面）",
        "实现 app/pages/xhs.vue",
        "实现 app/pages/settings.vue（可选）",
        "配置 app/app.vue",
        "类型检查通过"
      ],
      "priority": 18,
      "passes": false
    },
    {
      "id": "US-019",
      "title": "设置 Store",
      "description": "作为用户，我希望设置被持久化，使偏好设置被记住。",
      "acceptanceCriteria": [
        "实现 stores/settings.ts",
        "包含分辨率、长宽比、流式传输、上下文数量设置",
        "自动保存开关",
        "持久化到 localStorage",
        "类型检查通过"
      ],
      "priority": 19,
      "passes": false
    },
    {
      "id": "US-020",
      "title": "最终集成与测试",
      "description": "作为开发者，我希望完整的应用经过测试和集成，使所有功能协同工作。",
      "acceptanceCriteria": [
        "所有 composables 和 stores 连接完成",
        "所有组件正确渲染",
        "图像生成流程端到端工作",
        "聊天持久化工作",
        "XHS 模块工作",
        "主题切换工作",
        "无控制台错误",
        "类型检查通过",
        "构建成功（pnpm build）"
      ],
      "priority": 20,
      "passes": false
    }
  ]
}
