# Gemini 3 Pro Image Preview - 产品需求文档 (PRD)

**版本**: v1.0.0
**日期**: 2026-02-06
**状态**: 已发布

---

## 目录

1. [产品概述](#1-产品概述)
2. [目标用户](#2-目标用户)
3. [功能需求](#3-功能需求)
4. [非功能需求](#4-非功能需求)
5. [技术架构](#5-技术架构)
6. [数据模型](#6-数据模型)
7. [模块关系图](#7-模块关系图)
8. [未来规划建议](#8-未来规划建议)

---

## 1. 产品概述

### 1.1 产品定位

Gemini 3 Pro Image Preview 是一款基于 Google Gemini 3 Pro 模型的现代化图像生成工作台。作为一个纯前端应用，它无需后端服务器支持，用户可直接在浏览器中使用全部功能。

### 1.2 产品愿景

打造一个功能强大、操作简便、用户体验优秀的 AI 图像生成平台，让创作者能够高效地进行图像创作、内容生产和创意实现。

### 1.3 核心价值

| 价值维度 | 描述 |
|---------|------|
| **高效创作** | 支持批量并发生成、多渠道轮询，大幅提升创作效率 |
| **专业品质** | 支持高达 4K 分辨率、11 种长宽比，满足专业创作需求 |
| **数据安全** | 纯前端架构，所有数据本地存储，隐私无忧 |
| **零门槛** | 无需安装，打开浏览器即可使用，无框架依赖 |
| **场景丰富** | 集成 XHS 创作、表情包制作、图片切片等多种创作工具 |

### 1.4 核心亮点

- **并发生成** - 支持批量并发生成图片，提高创作效率
- **4K 渲染** - 支持高达 4K 分辨率的图像生成
- **本地存储** - 使用 IndexedDB 本地存储对话历史
- **响应式设计** - 完美适配桌面端和移动端
- **暗黑模式** - 内置优雅的暗黑主题
- **对话上下文** - AI 可记住历史对话，实现连续创作

---

## 2. 目标用户

### 2.1 用户画像

#### 主要用户群体

| 用户类型 | 特征描述 | 核心需求 |
|---------|---------|---------|
| **内容创作者** | 自媒体运营、小红书博主、公众号作者 | 快速生成配图、批量制作内容素材 |
| **设计师** | UI/UX 设计师、平面设计师、插画师 | 获取设计灵感、生成概念图、快速原型 |
| **产品经理** | 互联网产品经理、项目经理 | 制作产品演示图、生成 PRD 配图 |
| **开发者** | 前端开发者、全栈工程师 | 测试 AI 模型、集成 API、二次开发 |
| **普通用户** | AI 技术爱好者、创意工作者 | 探索 AI 图像生成、满足个人创作需求 |

#### 次要用户群体

| 用户类型 | 特征描述 | 核心需求 |
|---------|---------|---------|
| **电商运营** | 淘宝/京东店铺运营人员 | 生成商品展示图、营销素材 |
| **教育工作者** | 教师、培训讲师 | 制作教学素材、课件配图 |
| **游戏开发者** | 独立游戏开发者、游戏美术 | 生成游戏概念图、角色设计 |

### 2.2 用户场景

#### 场景一：小红书内容创作

**用户**: 小红书博主小美
**场景**: 需要发布一篇关于"秋日穿搭"的笔记
**流程**:
1. 打开 XHS 灵感实验室
2. 输入主题"秋日森系穿搭"
3. AI 自动生成文案和分镜方案
4. 批量生成配图
5. 下载图片用于发布

#### 场景二：表情包制作

**用户**: 表情包爱好者小王
**场景**: 想制作一套可爱的 LINE 风格表情包
**流程**:
1. 点击"表情包制作"进入专用模式
2. 输入表情描述（如"开心的柴犬"）
3. 批量生成多个表情
4. 使用切片工具进行九宫格切图
5. 打包下载所有表情

#### 场景三：设计灵感获取

**用户**: UI 设计师小李
**场景**: 需要为 App 设计启动页配图
**流程**:
1. 使用提示词快查工具找到合适的提示词
2. 上传参考图作为风格参考
3. 设置 4K 分辨率和 9:16 比例
4. 生成多个版本进行对比
5. 选择最佳方案继续迭代

---

## 3. 功能需求

### 3.1 图像生成模块

#### 3.1.1 核心功能

| 功能项 | 描述 | 优先级 |
|-------|------|-------|
| 文本生成图像 | 根据用户输入的文本描述生成图像 | P0 |
| 参考图生成 | 支持上传参考图进行图像生成 | P0 |
| 批量生成 | 一次性生成 1-4 张图片 | P0 |
| 流式传输 | OpenAI 流式接收 API 响应，实时显示进度 | P1 |

#### 3.1.2 分辨率支持

| 分辨率 | 尺寸 | 适用场景 |
|-------|------|---------|
| 1K | 1024 x 1024 | 快速预览、社交媒体头像 |
| 2K | 2048 x 2048 | 常规使用、博客配图 |
| 4K | 4096 x 4096 | 高清输出、印刷品、专业设计 |

#### 3.1.3 长宽比支持

| 比例 | 方向 | 典型用途 |
|-----|------|---------|
| Auto | 自动 | 由 AI 自动选择最佳比例 |
| 21:9 | 超宽屏 | 电影画幅、Banner 图 |
| 16:9 | 宽屏 | 视频封面、PPT 配图 |
| 3:2 | 横向 | 相机照片、传统摄影 |
| 4:3 | 横向 | 电视画幅、展示图 |
| 5:4 | 横向 | 社交媒体、产品图 |
| 1:1 | 正方形 | Instagram、头像、表情包 |
| 4:5 | 竖向 | Instagram 竖图 |
| 3:4 | 竖向 | 海报、杂志封面 |
| 2:3 | 竖向 | 手机壁纸 |
| 9:16 | 竖向 | 手机全屏、短视频封面 |

#### 3.1.4 智能进度条 (SmartProgressBar)

- 根据分辨率自动估算生成时间
- 1K: 约 15 秒
- 2K: 约 30 秒
- 4K: 约 60 秒
- 实时显示生成进度百分比
- 支持取消生成操作

### 3.2 对话管理模块

#### 3.2.1 会话管理

| 功能项 | 描述 | 优先级 |
|-------|------|-------|
| 创建会话 | 新建对话会话 | P0 |
| 切换会话 | 在多个会话间快速切换 | P0 |
| 删除会话 | 删除不需要的会话 | P0 |
| 会话持久化 | 使用 IndexedDB 存储，刷新页面不丢失 | P0 |
| 会话重命名 | 自定义会话名称 | P1 |

#### 3.2.2 消息操作

| 功能项 | 描述 | 优先级 |
|-------|------|-------|
| 发送消息 | 发送文本消息触发图像生成 | P0 |
| 复制消息 | 复制消息文本内容 | P1 |
| 编辑消息 | 编辑已发送的消息并重新生成 | P1 |
| 重新生成 | 基于同一提示词重新生成图像 | P1 |
| 删除消息 | 删除单条消息 | P1 |

#### 3.2.3 上下文记忆

| 保留条数 | 描述 | Token 消耗 |
|---------|------|-----------|
| 3 条 | 最小上下文，快速响应 | 低 |
| 5 条 | 默认设置，平衡效果 | 中 |
| 10 条 | 较长上下文，更好的连贯性 | 较高 |
| 20 条 | 最大上下文，完整历史回溯 | 高 |

### 3.3 API 渠道管理模块 (ProviderManager)

#### 3.3.1 渠道配置

| 配置项 | 描述 | 必填 |
|-------|------|-----|
| 渠道名称 | 自定义渠道标识 | 是 |
| 接口类型 | Gemini 原生接口 / OpenAI 兼容接口 | 是 |
| API Base URL | API 服务地址 | 是 |
| API Key | API 密钥 | 是 |
| Model | 模型名称 | 是 |

#### 3.3.2 渠道功能

| 功能项 | 描述 | 优先级 |
|-------|------|-------|
| 添加渠道 | 新增 API 渠道配置 | P0 |
| 编辑渠道 | 修改已有渠道配置 | P0 |
| 删除渠道 | 移除渠道配置 | P0 |
| 随机轮询 | 多渠道自动负载均衡 | P1 |
| 渠道测试 | 验证渠道可用性 | P2 |

#### 3.3.3 接口类型对比

| 特性 | Gemini 原生接口 | OpenAI 兼容接口 |
|-----|----------------|----------------|
| 协议格式 | Gemini API | OpenAI API |
| 流式传输 | 支持 | 支持 |
| 多模态输入 | 支持 | 支持 |
| 兼容性 | 仅限 Gemini | 多种模型 |

### 3.4 XHS 灵感实验室模块 (XHSCreator)

#### 3.4.1 功能概述

专为小红书内容创作设计的一站式工具，支持 AI 生成文案和配图方案。

#### 3.4.2 核心功能

| 功能项 | 描述 | 优先级 |
|-------|------|-------|
| 主题输入 | 输入创作主题或关键词 | P0 |
| 文案生成 | AI 自动生成小红书风格文案 | P0 |
| 分镜规划 | 生成配图方案和分镜描述 | P0 |
| 批量生成 | 一键生成所有分镜图片 | P0 |
| 图片分析 | 上传图片进行内容分析 | P1 |
| 历史记录 | 保存创作历史 (XHSDb) | P1 |

#### 3.4.3 界面布局

采用三栏布局设计:

| 区域 | 内容 |
|-----|------|
| 左栏 | 设置面板 + 历史记录 |
| 中栏 | 主题输入 + 生成文案 |
| 右栏 | 分镜墙（图片展示区） |

#### 3.4.4 独立 API 配置

XHS 模块支持独立配置文案生成 API，可使用不同于图像生成的模型。

### 3.5 提示词快查工具 (BananaTool)

#### 3.5.1 功能概述

集成 Banana Prompt 优质提示词库，帮助用户快速找到合适的提示词。

#### 3.5.2 核心功能

| 功能项 | 描述 | 优先级 |
|-------|------|-------|
| 关键词搜索 | 根据关键词搜索提示词 | P0 |
| 分类筛选 | 按类别筛选提示词 | P0 |
| 一键复制 | 复制提示词到剪贴板 | P0 |
| 快速填充 | 直接填充到对话输入框 | P0 |
| 保存收藏 | 保存到个人提示词库 | P1 |

#### 3.5.3 提示词分类

| 分类 | 描述 |
|-----|------|
| 绘图 | 图像生成相关提示词 |
| 生活 | 日常生活场景提示词 |
| 学习 | 教育学习类提示词 |
| 工作 | 职场办公类提示词 |
| NSFW | 成人内容（需用户确认） |

#### 3.5.4 数据源

- 多数据源容错加载机制
- 主数据源不可用时自动切换备用源
- 支持离线缓存

### 3.6 我的提示词模块 (CustomPromptTool)

#### 3.6.1 核心功能

| 功能项 | 描述 | 优先级 |
|-------|------|-------|
| 添加提示词 | 创建自定义提示词 | P0 |
| 编辑提示词 | 修改已有提示词 | P0 |
| 删除提示词 | 移除不需要的提示词 | P0 |
| 搜索功能 | 快速查找个人提示词 | P1 |
| 快速应用 | 一键应用到对话框 | P0 |

#### 3.6.2 数据结构

```
{
  id: string,          // 唯一标识
  title: string,       // 提示词标题
  content: string,     // 提示词内容
  category: string,    // 分类（可选）
  createdAt: timestamp,// 创建时间
  updatedAt: timestamp // 更新时间
}
```

### 3.7 表情包制作模式

#### 3.7.1 功能概述

一键进入专为表情包创作优化的生成模式。

#### 3.7.2 预设参数

| 参数 | 预设值 | 说明 |
|-----|-------|------|
| 风格 | LINE 风格 | 简洁可爱的贴纸风格 |
| 长宽比 | 16:9 | 适合表情包展示 |
| 分辨率 | 4K | 高清输出 |

#### 3.7.3 专用提示词模板

系统内置表情包生成的专用提示词模板，包含:
- 风格描述（LINE 风格、扁平化、卡通等）
- 背景设置（纯色背景、透明背景）
- 表情特征（表情包常用表情、动作）

### 3.8 图片切片工具 (SlicerTool)

#### 3.8.1 核心功能

| 功能项 | 描述 | 优先级 |
|-------|------|-------|
| 九宫格切图 | 将图片切成 3x3 九宫格 | P0 |
| 横线切割 | 添加水平切割线 | P0 |
| 竖线切割 | 添加垂直切割线 | P0 |
| 拖拽调整 | 拖拽调整切割线位置 | P1 |
| 1:1 补全 | 自动补全为正方形 | P1 |
| 一键打包 | JSZip 打包下载 | P0 |
| 2x 高清 | 双倍分辨率输出 | P1 |

#### 3.8.2 补全选项

| 选项 | 描述 |
|-----|------|
| 背景色填充 | 使用指定颜色填充空白区域 |
| 自动颜色 | 根据图片边缘自动选择填充色 |
| 透明背景 | 保持空白区域透明 |

### 3.9 文件系统管理器 (FileSystemManager)

#### 3.9.1 功能概述

基于 File System Access API 实现的本地文件自动保存功能。

#### 3.9.2 核心功能

| 功能项 | 描述 | 优先级 |
|-------|------|-------|
| 目录选择 | 选择本地保存目录 | P0 |
| 自动保存 | 生成图片自动保存到本地 | P0 |
| 权限管理 | 管理文件系统访问权限 | P1 |

#### 3.9.3 浏览器兼容性

| 浏览器 | 版本要求 | 支持状态 |
|-------|---------|---------|
| Chrome | 86+ | 完全支持 |
| Edge | 86+ | 完全支持 |
| Firefox | - | 不支持 |
| Safari | - | 不支持 |

#### 3.9.4 优势

- 不占用浏览器存储空间
- 文件直接保存到本地磁盘
- 支持大量图片存储
- 可与其他应用直接共享文件

### 3.10 主题切换模块

#### 3.10.1 主题选项

| 主题 | 描述 |
|-----|------|
| 明亮模式 | 浅色背景，适合白天使用 |
| 暗黑模式 | 深色背景，保护眼睛，适合夜间使用 |

#### 3.10.2 实现方式

- 使用 CSS Variables 实现主题切换
- 主题偏好自动保存到 localStorage
- 页面加载时自动应用上次选择的主题

### 3.11 UI 反馈系统

#### 3.11.1 Toast 提示 (showToast)

| 类型 | 描述 | 显示时长 |
|-----|------|---------|
| success | 操作成功提示 | 3 秒 |
| error | 错误信息提示 | 5 秒 |
| warning | 警告信息提示 | 4 秒 |
| info | 普通信息提示 | 3 秒 |

#### 3.11.2 加载状态 (LoadingManager)

- 全局加载遮罩
- 支持自定义加载文案
- 防止用户重复操作

#### 3.11.3 进度条

| 组件 | 用途 |
|-----|------|
| ProgressBar | 通用进度条组件 |
| SmartProgressBar | 智能进度条，根据任务类型估算时间 |

#### 3.11.4 错误处理 (ErrorHandler)

- 统一的错误捕获和处理
- 友好的错误信息展示
- 错误日志记录（控制台）

#### 3.11.5 图片预览 (Lightbox)

- 点击图片放大查看
- 支持缩放和拖拽
- 键盘快捷键支持（ESC 关闭）

### 3.12 工具函数库

| 函数 | 功能描述 |
|-----|---------|
| escapeHtml | HTML 特殊字符转义，防止 XSS |
| BlobManager | Blob URL 生命周期管理 |
| downloadImage | 图片下载功能封装 |
| base64ToBlobUrl | Base64 编码转 Blob URL |

---

## 4. 非功能需求

### 4.1 性能需求

| 指标 | 要求 |
|-----|------|
| 首屏加载时间 | < 2 秒 |
| 图片渲染时间 | < 500ms |
| 内存占用 | < 500MB（常规使用） |
| IndexedDB 容量 | 支持存储 1000+ 条消息 |

### 4.2 兼容性需求

| 平台 | 最低版本 | 核心功能 | 自动保存 |
|-----|---------|---------|---------|
| Chrome | 86+ | 完全支持 | 支持 |
| Edge | 86+ | 完全支持 | 支持 |
| Firefox | 最新版 | 完全支持 | 不支持 |
| Safari | iOS 14+ | 完全支持 | 不支持 |

### 4.3 安全需求

| 需求项 | 描述 |
|-------|------|
| API Key 保护 | API Key 仅存储在本地，不传输到第三方服务器 |
| XSS 防护 | 所有用户输入进行 HTML 转义 |
| CSP 策略 | 限制外部资源加载 |
| HTTPS | 推荐使用 HTTPS 部署 |

### 4.4 可用性需求

| 需求项 | 描述 |
|-------|------|
| 响应式设计 | 自动适配桌面端和移动端 |
| 触摸支持 | 移动端触摸手势支持 |
| 键盘快捷键 | 常用操作支持键盘快捷键 |
| 无障碍 | 基础的 ARIA 标签支持 |

### 4.5 可维护性需求

| 需求项 | 描述 |
|-------|------|
| 代码规范 | 遵循现代 JavaScript 最佳实践 |
| 模块化 | 功能模块清晰划分 |
| 注释完善 | 关键代码有清晰注释 |
| 版本控制 | Git 版本管理 |

---

## 5. 技术架构

### 5.1 技术栈

| 层级 | 技术选型 | 说明 |
|-----|---------|------|
| 前端框架 | 原生 JavaScript | 无框架依赖，轻量高效 |
| 样式方案 | CSS3 + CSS Variables | 原生 CSS，支持主题切换 |
| 本地存储 | IndexedDB | 大容量结构化数据存储 |
| 文件系统 | File System Access API | 本地文件读写 |
| Markdown | marked.js | Markdown 解析渲染 |
| 压缩工具 | JSZip | 文件打包下载 |

### 5.2 系统架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                         用户界面层                               │
│  ┌──────────┬──────────────────────────┬─────────────────────┐  │
│  │  侧边栏   │        主内容区           │      设置面板       │  │
│  │          │                          │                     │  │
│  │ 创作工具  │       对话列表            │    API 渠道管理      │  │
│  │ 会话列表  │       消息展示            │    生成参数设置      │  │
│  │          │       输入区域            │    主题切换         │  │
│  └──────────┴──────────────────────────┴─────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│                         业务逻辑层                               │
│  ┌─────────────┬─────────────┬─────────────┬─────────────────┐  │
│  │ 图像生成模块 │  对话管理模块  │ API 渠道模块  │   创作工具模块   │  │
│  │             │             │             │                 │  │
│  │ sendMessage │   会话CRUD   │ProviderMgr  │   XHSCreator    │  │
│  │ processGen  │   消息CRUD   │ 渠道轮询     │   BananaTool    │  │
│  │ SmartProgress│  上下文管理  │             │   SlicerTool    │  │
│  └─────────────┴─────────────┴─────────────┴─────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│                         数据存储层                               │
│  ┌───────────────────┬──────────────────┬────────────────────┐  │
│  │     IndexedDB     │   localStorage   │  File System API   │  │
│  │                   │                  │                    │  │
│  │  GeminiProDB      │  API 渠道配置     │  自动保存目录       │  │
│  │  - sessions       │  主题偏好         │  生成图片存储       │  │
│  │  - messages       │  流式传输开关     │                    │  │
│  │                   │  上下文设置       │                    │  │
│  │  XHSHistoryDB     │  自定义提示词     │                    │  │
│  │  - history        │                  │                    │  │
│  └───────────────────┴──────────────────┴────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│                         外部服务层                               │
│  ┌─────────────────────────┬─────────────────────────────────┐  │
│  │    Gemini 原生接口       │      OpenAI 兼容接口            │  │
│  │                         │                                 │  │
│  │  generativelanguage.    │   api.openai.com               │  │
│  │  googleapis.com         │   或其他兼容端点                 │  │
│  └─────────────────────────┴─────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

### 5.3 核心模块说明

#### 5.3.1 图像生成引擎

```javascript
// 核心生成流程
sendMessage(prompt, options) {
    1. 构建请求参数（分辨率、长宽比、参考图）
    2. 选择 API 渠道（随机轮询）
    3. 发送请求（支持流式/非流式）
    4. 处理响应（processGeneration）
    5. 渲染结果（更新 UI）
    6. 自动保存（FileSystemManager）
}
```

#### 5.3.2 渠道管理器

```javascript
class ProviderManager {
    - providers: Array        // 渠道列表
    - currentIndex: number    // 当前渠道索引

    + addProvider(config)     // 添加渠道
    + removeProvider(id)      // 删除渠道
    + getRandomProvider()     // 随机获取渠道
    + testProvider(id)        // 测试渠道
}
```

#### 5.3.3 数据库管理

```javascript
// GeminiProDB
{
    sessions: {
        id, title, createdAt, updatedAt
    },
    messages: {
        id, sessionId, role, content, images, timestamp
    }
}

// XHSHistoryDB
{
    history: {
        id, topic, content, images, createdAt
    }
}
```

---

## 6. 数据模型

### 6.1 IndexedDB - GeminiProDB

#### 6.1.1 sessions 表

| 字段 | 类型 | 描述 | 索引 |
|-----|------|------|-----|
| id | string | 会话唯一标识 (UUID) | 主键 |
| title | string | 会话标题 | - |
| createdAt | timestamp | 创建时间 | 是 |
| updatedAt | timestamp | 最后更新时间 | 是 |

#### 6.1.2 messages 表

| 字段 | 类型 | 描述 | 索引 |
|-----|------|------|-----|
| id | string | 消息唯一标识 (UUID) | 主键 |
| sessionId | string | 所属会话 ID | 是 |
| role | string | 角色 (user/assistant) | - |
| content | string | 消息文本内容 | - |
| images | array | 图片数据数组 (Base64) | - |
| timestamp | timestamp | 消息时间 | 是 |

### 6.2 IndexedDB - XHSHistoryDB

#### 6.2.1 history 表

| 字段 | 类型 | 描述 | 索引 |
|-----|------|------|-----|
| id | string | 记录唯一标识 (UUID) | 主键 |
| topic | string | 创作主题 | - |
| content | string | 生成的文案内容 | - |
| storyboard | array | 分镜描述数组 | - |
| images | array | 生成的图片数组 | - |
| createdAt | timestamp | 创建时间 | 是 |

### 6.3 localStorage 数据

| Key | 类型 | 描述 |
|-----|------|------|
| api_providers | JSON | API 渠道配置列表 |
| theme | string | 主题偏好 (light/dark) |
| stream_enabled | boolean | 流式传输开关 |
| context_count | number | 上下文保留条数 |
| auto_save_enabled | boolean | 自动保存开关 |
| auto_save_directory | string | 自动保存目录句柄 |
| custom_prompts | JSON | 自定义提示词列表 |
| resolution | string | 默认分辨率 |
| aspect_ratio | string | 默认长宽比 |

### 6.4 内存数据结构

#### 6.4.1 生成请求

```javascript
{
    prompt: string,           // 提示词
    resolution: string,       // 分辨率 (1K/2K/4K)
    aspectRatio: string,      // 长宽比
    referenceImage: string,   // 参考图 (Base64, 可选)
    batchSize: number,        // 批量生成数量
    stream: boolean           // 是否流式传输
}
```

#### 6.4.2 生成响应

```javascript
{
    success: boolean,
    images: [
        {
            data: string,     // Base64 图片数据
            mimeType: string  // 图片类型
        }
    ],
    text: string,             // 文本响应
    usage: {
        promptTokens: number,
        completionTokens: number
    }
}
```

---

## 7. 模块关系图

### 7.1 模块依赖关系

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              应用入口 (index.html)                        │
│                                     │                                    │
│                                     ▼                                    │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │                         app.js (主模块)                           │   │
│  │                                                                   │   │
│  │  ┌─────────────┐    ┌─────────────┐    ┌─────────────────────┐  │   │
│  │  │ProviderMgr  │───▶│ 图像生成模块 │◀───│ FileSystemManager   │  │   │
│  │  │(API 渠道)   │    │             │    │ (自动保存)           │  │   │
│  │  └─────────────┘    └──────┬──────┘    └─────────────────────┘  │   │
│  │                            │                                     │   │
│  │         ┌──────────────────┼──────────────────┐                  │   │
│  │         ▼                  ▼                  ▼                  │   │
│  │  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐          │   │
│  │  │ 对话管理模块 │    │ XHSCreator  │    │ SlicerTool  │          │   │
│  │  │             │    │ (XHS灵感)   │    │ (图片切片)   │          │   │
│  │  └──────┬──────┘    └──────┬──────┘    └─────────────┘          │   │
│  │         │                  │                                     │   │
│  │         ▼                  ▼                                     │   │
│  │  ┌─────────────┐    ┌─────────────┐                              │   │
│  │  │ GeminiProDB │    │ XHSHistoryDB│                              │   │
│  │  │ (IndexedDB) │    │ (IndexedDB) │                              │   │
│  │  └─────────────┘    └─────────────┘                              │   │
│  │                                                                   │   │
│  │  ┌─────────────┐    ┌─────────────┐    ┌─────────────────────┐  │   │
│  │  │ BananaTool  │    │CustomPrompt │    │    UI 反馈系统       │  │   │
│  │  │ (提示词库)  │───▶│ (我的提示词) │    │ Toast/Loading/等    │  │   │
│  │  └─────────────┘    └─────────────┘    └─────────────────────┘  │   │
│  │                                                                   │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 7.2 数据流向图

```
用户输入
    │
    ▼
┌─────────────────┐
│   提示词输入框   │◀────────────┬────────────┐
└────────┬────────┘             │            │
         │                      │            │
         ▼                      │            │
┌─────────────────┐     ┌───────┴───────┐   │
│  ProviderManager │     │  BananaTool   │   │
│  (选择API渠道)   │     │  (提示词库)   │   │
└────────┬────────┘     └───────────────┘   │
         │                                   │
         ▼                                   │
┌─────────────────┐     ┌───────────────┐   │
│  API 请求发送    │     │ CustomPrompt  │───┘
│  (Gemini/OpenAI)│     │ (我的提示词)  │
└────────┬────────┘     └───────────────┘
         │
         ▼
┌─────────────────┐
│  响应处理        │
│  processGeneration│
└────────┬────────┘
         │
    ┌────┴────┬────────────┐
    ▼         ▼            ▼
┌───────┐ ┌───────┐ ┌──────────────┐
│ UI 渲染│ │IndexedDB│ │FileSystemMgr│
│ 展示图片│ │ 保存消息│ │ 自动保存     │
└───────┘ └───────┘ └──────────────┘
    │
    ▼
┌─────────────────┐
│   用户操作       │
│ 设为参考图/切片  │
└────────┬────────┘
         │
    ┌────┴────┐
    ▼         ▼
┌───────┐ ┌───────────┐
│ 继续生成│ │ SlicerTool│
│ (循环) │ │ (切片下载) │
└───────┘ └───────────┘
```

### 7.3 模块职责说明

| 模块 | 职责 | 依赖模块 | 被依赖模块 |
|-----|------|---------|-----------|
| ProviderManager | API 渠道配置与管理 | localStorage | 图像生成, XHSCreator |
| 图像生成模块 | 核心图像生成逻辑 | ProviderManager | 对话管理, XHSCreator |
| 对话管理模块 | 会话和消息管理 | GeminiProDB | - |
| XHSCreator | 小红书内容创作 | ProviderManager, XHSHistoryDB | - |
| BananaTool | 提示词库查询 | 外部数据源 | CustomPromptTool |
| CustomPromptTool | 个人提示词管理 | localStorage | - |
| SlicerTool | 图片切片处理 | JSZip | - |
| FileSystemManager | 本地文件存储 | File System API | 图像生成 |
| UI 反馈系统 | 用户交互反馈 | - | 所有模块 |

---

## 8. 未来规划建议

### 8.1 短期规划 (1-3 个月)

#### 8.1.1 功能增强

| 功能 | 描述 | 优先级 |
|-----|------|-------|
| 图片编辑器 | 内置基础图片编辑功能（裁剪、滤镜、标注） | P1 |
| 批量操作 | 支持批量删除、导出会话历史 | P1 |
| 快捷键系统 | 完善的键盘快捷键支持 | P2 |
| 拖拽上传 | 支持拖拽上传参考图 | P2 |

#### 8.1.2 用户体验

| 优化项 | 描述 | 优先级 |
|-------|------|-------|
| 引导教程 | 新用户引导流程 | P1 |
| 多语言支持 | 英语、日语等多语言界面 | P2 |
| 自定义主题 | 支持用户自定义配色方案 | P3 |

### 8.2 中期规划 (3-6 个月)

#### 8.2.1 高级功能

| 功能 | 描述 | 优先级 |
|-----|------|-------|
| 图像放大 | 集成 AI 图像超分辨率功能 | P1 |
| 背景移除 | 一键去除图片背景 | P1 |
| 风格迁移 | 将参考图风格应用到新生成图片 | P2 |
| 图像修复 | 支持局部重绘和内容填充 | P2 |

#### 8.2.2 协作功能

| 功能 | 描述 | 优先级 |
|-----|------|-------|
| 云端同步 | 可选的云端数据同步（需后端） | P2 |
| 分享功能 | 生成分享链接 | P2 |
| 团队协作 | 多人协作工作区 | P3 |

### 8.3 长期规划 (6-12 个月)

#### 8.3.1 平台化

| 方向 | 描述 |
|-----|------|
| 插件系统 | 开放插件接口，支持第三方扩展 |
| 模板市场 | 用户可分享和下载提示词模板 |
| API 开放 | 提供 API 接口供第三方调用 |

#### 8.3.2 AI 能力扩展

| 方向 | 描述 |
|-----|------|
| 多模型支持 | 集成更多 AI 图像模型（DALL-E、Midjourney） |
| 视频生成 | 支持 AI 视频生成功能 |
| 3D 生成 | 支持 3D 模型生成 |

#### 8.3.3 移动端 App

| 方向 | 描述 |
|-----|------|
| PWA 优化 | 渐进式 Web 应用，支持离线使用 |
| 原生 App | 开发 iOS/Android 原生应用 |
| 桌面客户端 | Electron 桌面应用 |

### 8.4 技术债务清理

| 项目 | 描述 | 优先级 |
|-----|------|-------|
| TypeScript 迁移 | 将 JavaScript 迁移到 TypeScript | P2 |
| 单元测试 | 添加完整的单元测试覆盖 | P2 |
| E2E 测试 | 添加端到端自动化测试 | P3 |
| 性能优化 | 大量历史消息时的性能优化 | P2 |
| 代码拆分 | 将 app.js 拆分为多个模块文件 | P2 |

---

## 附录

### A. 术语表

| 术语 | 解释 |
|-----|------|
| Gemini | Google 开发的多模态 AI 模型 |
| IndexedDB | 浏览器内置的 NoSQL 数据库 |
| File System Access API | 浏览器访问本地文件系统的 API |
| Base64 | 一种二进制数据编码方式 |
| Blob | 二进制大对象，用于存储文件数据 |
| UUID | 通用唯一识别码 |
| XHS | 小红书的简称 |
| LINE 风格 | 日本 LINE 应用的表情贴纸风格 |

### B. 参考资料

- [Google Gemini API 文档](https://ai.google.dev/docs)
- [IndexedDB MDN 文档](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API)
- [File System Access API](https://developer.chrome.com/docs/capabilities/web-apis/file-system-access)
- [Banana Prompt 项目](https://github.com/glidea/banana-prompt-quicker)

### C. 版本历史

| 版本 | 日期 | 变更说明 |
|-----|------|---------|
| v1.0.0 | 2026-01-04 | 初始版本发布 |

---

**文档维护者**: Gemini 3 Pro Image Preview Team
**最后更新**: 2026-02-06
